---
title: "ForestHerNC_MPAnalysis"
author: "Emma Childs"
date: "2024-01-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r loading packages, include=FALSE, warning=FALSE, message=FALSE}

rm(list=ls())
library(ggplot2)
library(tidyr)
library(tidyverse)
library(plm)
library(GGally)
library(car)
library(lmtest)
library(sandwich)
library(gt)
library(ggrepel)
library(tinytex)
#installing and loading necessary packages
#tinytex::install_tinytex() when first starting to be able to knit into spiffy looking PDFs if necessary. 

```


```{r working directory, include=FALSE, warning=FALSE, message=FALSE}

#setwd("C:/Users/EmmaC/Documents/Duke_Academics/Fall_2023_Classes/MASTERS_PROJECT/R_Coding/FHNC_Rcode")
#don't need this code chunk bc I set up a R Project folder that renders this unnecessary. 

```


```{r reading in original FHNC survey data, include=FALSE, warning=FALSE, message=FALSE}

FHNC23.df<-read_csv("ORIGINAL_ForestHerNC_2023Implementation_Survey.csv") %>%
  glimpse()

FHNC23.df
#reading in CSV files for 2023 ForestHer NC end of year implementation survey. 

``` 


```{r correcting Qualtrics formatting}

FHNC23.data.df <- read_csv("ORIGINAL_ForestHerNC_2023Implementation_Survey.csv", 
    col_names = FALSE, skip = 3)
#reading in only data
FHNC23.Qs.df <- read_csv("ORIGINAL_ForestHerNC_2023Implementation_Survey.csv", 
    n_max = 1)
#reading in Qualtrics questions that get embedded in CSV file that we may want to use later.

my_colnames_vec <- colnames(FHNC23.Qs.df)

colnames(FHNC23.data.df) <- my_colnames_vec

```


```{r initial column cleaning}

FHNC23.clean.df <- FHNC23.data.df %>% 
  select(Progress, ResponseId, Q2:Q23)
#Eliminated several superfluous columns with information that was not needed for analysis (start time, end time, etc.)

```

COME BACK AND WORK HERE

```{r cleaning for higher completion survey rates, eval=FALSE}

FHNC23.clean.df <- FHNC23.clean.df %>%
  filter(Progress > 20)
#Could come back and make this threshold higher depending on what I'm looking for. Do I want to select or filter for the threshold?

```


```{r group by mgmt activity}

#See Dakota's pivot table for designations 

```


```{r FHNC analyses}

#consult list of planned analyses

```


```{r subset cooperative data}

#FHNC23.coop.df <- FHNC23.clean.df %>% 
  #select(Progress = 100) %>%
  #select(Progress, ResponseId, Q5, Q8:Q12, Q16:Q19)
#Am I selecting all the right columns or do I want to add more?

question_8_text <- FHNC23.Qs.df %>% 
  select(IPAddress, starts_with("Q8_")) %>% 
  pivot_longer(-IPAddress, names_to = "question", values_to = "question_text") %>% 
  mutate(question_short = str_remove(question_text, "Please select your level of interest in each of the following different services that cooperative forest management can offer. - Coordinating with adjacent landowners (on|to) ")) %>% 
  pull(question_short)
question_8_text
  
my_levels_8 <- c("Not Interested", "Not Sure", "Somewhat Interested", "Very Interested")
# my_levels_8 <- rev(c("Not Interested", "Not Sure", "Somewhat Interested", "Very Interested"))

# glimpse()
question_8_df <- FHNC23.clean.df %>% 
  select(ResponseId, starts_with("Q8_")) %>% 
  pivot_longer(-ResponseId, names_to = "question", values_to = "response") %>% 
  count(question, response) # %>% 
  # mutate(response = factor(response, levels = my_levels_8)) 

question_8_df
  # filter(Progress == 100) %>%
  # mutate(question = if_else(question == "Q8_1", "special", question))
  # mutate(question = case_when(
  #   question == "Q8_1" ~ "special-thing1",
  #   question == "Q8_2" ~ "special-thing2",
  #   TRUE ~ "foo"
  # ))
  # drop_na(response)
  # arrange(response, desc(n))

question_8_df %>% 
  ggplot(aes(x = question, y = n)) +
  geom_col(aes(fill = response)) 

# question_8_df %>% 
#   ggplot(aes(x = question, y = n)) +
#   geom_col(aes(fill = response)) +
#   facet_wrap(vars(question))

```


```{r recode cooperative Qs to numeric}

#Qs 8-11 (12 also is a coop Q but character response) - need to match USFS coding - add column for 1-5 values?
```


```{r test run visualize Q8}

#barchart/histogram by response type (1-5)...and then could do a further visualization by region?

```

# Go through each question and figure out what value I want or need from that Q for analysis. (Prioritize the columns I know that I want, and then work backyards.)

#Start recoding Likert cooperative Qs to be numeric - can use recode() or other code Lauren sent - use same numeric values that USFS uses that Jesse sent
